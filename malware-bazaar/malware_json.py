import requests
import os
from jq import jq

import API_Key


if __name__ == '__main__':
    data = {'query': 'get_recent', 'selector': "time"}
    response = requests.post('https://mb-api.abuse.ch/api/v1/', data=data, timeout=15)
    json_response = response.content.decode("utf-8", "ignore")
    response = jq(".data[].sha256_hash").transform(text=json_response, multiple_output=True)

    for sample_sha256 in response:
        if(os.path.isfile(sample_sha256+'.json') == False):
            data = {'query': 'get_info', 'hash': sample_sha256}
            response = requests.post('https://mb-api.abuse.ch/api/v1/', data=data, timeout=15, allow_redirects=True)
            open(sample_sha256+'.json', 'wb').write(response.content)