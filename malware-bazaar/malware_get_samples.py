import requests
import API_Key

from jq import jq


def get_sample():

    headers = { 'API-KEY': API_Key.MalwareBazaarAPI }

    data = {
        'query': 'get_recent',
        'selector': 'time',
    }

    response = requests.post('https://mb-api.abuse.ch/api/v1/', data=data, timeout=5, headers=headers)
    json_response = response.content.decode("utf-8", "ignore")

    # jq를 사용하여 필요한 해시들만 추출
    hashes = jq(".data[].sha256_hash").transform(text=json_response, text_output=True).replace('"', '').split('\n')
    file_types = jq(".data[].file_type").transform(text=json_response, text_output=True).replace('"', '').split('\n')
    #print(file_types)

    for hash_value, file_type in zip(hashes, file_types):
        if file_type == 'exe' :
            print(hash_value)

if __name__ == "__main__":

    get_sample()
